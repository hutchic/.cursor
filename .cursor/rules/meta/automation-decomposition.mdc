---
description: "When creating automations (workflows that combine multiple steps), decompose into discrete skills (the 'how') then package them into commands (the 'when' and order). Do not implement multi-step automations as a single bespoke command or skill."
alwaysApply: true
---

# Automation Decomposition

When creating automations—workflows that combine multiple steps—decompose them into **discrete skills** (the "how") and then **package those skills into commands** (the "when" and in what order). Commands orchestrate; skills implement.

## Principle

- **Skills** = reusable "how" (instructions, criteria, format, judgment for one capability).
- **Commands** = "when" and "in what order" (a workflow that invokes one or more skills and steps).

A multi-step automation should not be implemented as a single bespoke command or skill. It should be split into skills per logical capability, then composed by a command.

## When This Applies

- When designing any automation that has more than one logical step (e.g. stage → commit → push → open PR).
- When adding a new command that could be broken into reusable parts.
- When adding a new skill that is really several capabilities in one (split it).
- When reviewing or refactoring existing commands or skills.

## How to Decompose

### 1. Identify Discrete Capabilities

List each part of the workflow that has its own "how":

- **Stage related files** → skill: how to group changes, what to stage together, when to split commits.
- **Write a terse semantic commit** → skill: format, types, scope, imperative, length.
- **Push** → step or small skill (e.g. when to push, which branch, handling rejections).
- **Open a PR** → skill: how to write title/body, what to include, using `gh` or UI.

Each of these is a candidate for a **skill** (or a simple step if there is no real "how").

### 2. Create One Skill per Capability

- One skill = one capability, one "how."
- Skills are reusable across commands and contexts.
- Keep skills focused so they can be composed in different workflows.

### 3. Create a Command That Orchestrates

- The command is a single workflow: "Do step 1 (using skill A), then step 2 (using skill B), then step 3…"
- The command file lists the order and which skill (or step) to use at each point.
- The command does not reimplement the "how"; it references the skills.

## Do

- Decompose multi-step automations into discrete skills, then one command that composes them.
- Name skills by capability (e.g. `stage-related-files`, `terse-semantic-commits`, `open-pr`).
- Have the command explicitly reference the skills it uses (e.g. "Use the X skill; then use the Y skill").
- Prefer reusing existing skills in new commands rather than duplicating logic in a new skill.

## Don't

- Don't implement a multi-step workflow as a single bespoke command that inlines all the "how."
- Don't implement a multi-step workflow as a single monolithic skill.
- Don't skip decomposition because "it's just one workflow"—the skills are reusable and the mental model stays clear.

## Example: Commit-and-PR Workflow

**Wrong:** One command that does "stage, write commit message, run pre-commit, commit, push, open PR" with all the message-format and PR-title logic inlined.

**Right:**

- **Skills:** e.g. ensure-feature-branch (create branch if on mainline/release), stage-related-files (how to group), terse-semantic-commits (format and rules), open-pr (title/body and tooling). Push can be a step or a tiny skill.
- **Command:** e.g. "Run commit-and-pr: (1) Use ensure-feature-branch skill, (2) Use stage-related-files skill, (3) Use terse-semantic-commits skill and run commit, (4) Push, (5) Use open-pr skill (or command) to open the PR."

The [shipit command](.cursor/commands/shipit.md) implements this workflow using the ensure-feature-branch, stage-related-files, terse-semantic-commits, and open-pr skills.

## Related Artifacts

- [Shipit Command](.cursor/commands/shipit.md) – Example: ensure feature branch, stage, commit, push, open or update PR (uses ensure-feature-branch, stage-related-files, terse-semantic-commits, open-pr skills)
- [Artifact Creation Rule](.cursor/rules/meta/artifact-creation.mdc) – When to create a rule, skill, command, or subagent
- [Hello World Rule](.cursor/rules/hello-world.mdc) – Rule → skill → command relationship
- [Create Artifact Command](.cursor/commands/meta/create-artifact.md) – Creating new artifacts
- [Cursor Commands Documentation](docs/cursor-commands.md) – What commands are
- [Cursor Skills Documentation](docs/cursor-skills.md) – What skills are
